<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irregular Verb Practice</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for input correctness */
        .correct {
            border-color: #22c55e; /* green-500 */
            background-color: #f0fdf4; /* green-50 */
        }
        .incorrect {
            border-color: #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-md">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">
            Irregular Verb Practice
        </h1>

        <!-- Error Area -->
        <div id="error-container" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
            <strong class="font-bold">Error:</strong>
            <span class="block sm:inline" id="error-message"></span>
        </div>

        <!-- Prompt Area -->
        <div class="mb-5">
            <label id="prompt-label" class="text-sm font-medium text-gray-600 mb-1 block">Base Form</label>
            <div id="prompt-verb" class="text-3xl font-bold text-blue-600 bg-gray-50 p-3 rounded-lg">
                ...
            </div>
        </div>

        <!-- Input Area -->
        <div class="space-y-4">
            <div>
                <label id="input-label-1" for="input-1" class="text-sm font-medium text-gray-600">Past Simple</label>
                <input type="text" id="input-1" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg text-lg" placeholder="Enter past simple...">
            </div>
            <div>
                <label id="input-label-2" for="input-2" class="text-sm font-medium text-gray-600">Past Participle</label>
                <input type="text" id="input-2" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg text-lg" placeholder="Enter past participle...">
            </div>
        </div>

        <!-- Feedback Area -->
        <div id="feedback" class="mt-5 p-3 rounded-lg text-center font-medium hidden"></div>

        <!-- Button Area -->
        <div class="mt-6">
            <button id="check-btn" class="w-full bg-blue-600 text-white p-3 rounded-lg text-lg font-semibold hover:bg-blue-700 transition">
                Check Answer
            </button>
            <button id="next-btn" class="w-full bg-gray-700 text-white p-3 rounded-lg text-lg font-semibold hover:bg-gray-800 transition hidden">
                Next Question
            </button>
        </div>
    </div>

    <script>
        // --- CONSTANTS ---
        const VERB_FILE = 'irregular-verbs.csv';

        // --- STATE ---
        let verbList = [];
        let currentVerb = {};
        let quizMode = 0; // 0: guess simple/participle, 1: guess base/participle, 2: guess base/simple

        // --- DOM ELEMENTS ---
        const appContainer = document.getElementById('app-container');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        const promptLabel = document.getElementById('prompt-label');
        const promptVerb = document.getElementById('prompt-verb');
        const input1 = document.getElementById('input-1');
        const input2 = document.getElementById('input-2');
        const inputLabel1 = document.getElementById('input-label-1');
        const inputLabel2 = document.getElementById('input-label-2');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const feedback = document.getElementById('feedback');

        // --- FUNCTIONS ---

        /**
         * Displays a fatal error message and hides the app.
         */
        function showFatalError(message) {
            appContainer.style.display = 'none'; // Hide the main app UI
            
            // Create a new error box to show outside the app container
            const errorBox = document.createElement('div');
            errorBox.className = "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl shadow-lg w-full max-w-md";
            errorBox.setAttribute('role', 'alert');
            errorBox.innerHTML = `
                <strong class="font-bold">App Failed to Load</strong>
                <p class="block mt-2">${message}</p>
                <p class="text-sm mt-2">
                    <strong>Note:</strong> If you are running this file locally (from <code>file:///</code>), 
                    it will not work due to browser security rules. You must use a local server.
                </p>
            `;
            document.body.appendChild(errorBox);
        }

        /**
         * Fetches and parses the CSV data into the verbList array.
         */
        async function loadAndParseCSV() {
            try {
                const response = await fetch(VERB_FILE);
                if (!response.ok) {
                    throw new Error(`Could not find '${VERB_FILE}'. Status: ${response.status}`);
                }
                const csvData = await response.text();
                
                const lines = csvData.trim().split('\n');
                if (lines.length <= 1) {
                    throw new Error("CSV file is empty or has no verb data.");
                }
                
                verbList = lines.slice(1).map(line => {
                    const values = line.split(',');
                    if (values.length >= 3) {
                        return {
                            base: values[0].trim(),
                            simple: values[1].trim(),
                            participle: values[2].trim()
                        };
                    }
                    return null; // Handle potentially empty or malformed lines
                }).filter(verb => verb !== null); // Filter out any bad lines

                if (verbList.length === 0) {
                     throw new Error("CSV file loaded, but no valid verb data was found.");
                }

            } catch (error) {
                console.error('Failed to load or parse CSV:', error);
                showFatalError(`Could not load or read <code>${VERB_FILE}</code>. <br> ${error.message}`);
            }
        }

        /**
         * Loads a new random question.
         */
        function loadQuestion() {
            // Pick a random verb
            currentVerb = verbList[Math.floor(Math.random() * verbList.length)];
            
            // Pick a random quiz mode (0, 1, or 2)
            quizMode = Math.floor(Math.random() * 3);

            // Reset UI
            input1.value = '';
            input2.value = '';
            input1.disabled = false;
            input2.disabled = false;
            input1.classList.remove('correct', 'incorrect');
            input2.classList.remove('correct', 'incorrect');
            feedback.classList.add('hidden');
            checkBtn.classList.remove('hidden');
            nextBtn.classList.add('hidden');

            switch (quizMode) {
                case 0: // Prompt with Base Form
                    promptLabel.textContent = 'Base Form (V1)';
                    promptVerb.textContent = currentVerb.base;
                    inputLabel1.textContent = 'Past Simple (V2)';
                    input1.placeholder = 'Enter past simple...';
                    inputLabel2.textContent = 'Past Participle (V3)';
                    input2.placeholder = 'Enter past participle...';
                    break;
                case 1: // Prompt with Past Simple
                    promptLabel.textContent = 'Past Simple (V2)';
                    promptVerb.textContent = currentVerb.simple;
                    inputLabel1.textContent = 'Base Form (V1)';
                    input1.placeholder = 'Enter base form...';
                    inputLabel2.textContent = 'Past Participle (V3)';
                    input2.placeholder = 'Enter past participle...';
                    break;
                case 2: // Prompt with Past Participle
                    promptLabel.textContent = 'Past Participle (V3)';
                    promptVerb.textContent = currentVerb.participle;
                    inputLabel1.textContent = 'Base Form (V1)';
                    input1.placeholder = 'Enter base form...';
                    inputLabel2.textContent = 'Past Simple (V2)';
                    input2.placeholder = 'Enter past simple...';
                    break;
            }
        }

        /**
         * Checks if a user's answer matches one of the possible correct answers.
         * Handles cases like "burnt/burned".
         * @param {string} userInput - The user's input.
         * @param {string} correctAnswers - The correct answer string (e.g., "burnt/burned").
         * @returns {boolean} - True if the input is correct.
         */
        function isAnswerCorrect(userInput, correctAnswers) {
            const normalizedInput = userInput.trim().toLowerCase();
            const possibleAnswers = correctAnswers.split('/').map(ans => ans.toLowerCase());
            return possibleAnswers.includes(normalizedInput);
        }

        /**
         * Checks the user's answers and provides feedback.
         */
        function checkAnswer() {
            const userAnswer1 = input1.value;
            const userAnswer2 = input2.value;

            let answer1, answer2, correct1, correct2;

            // Determine which answers to check based on quizMode
            switch (quizMode) {
                case 0: // Prompted with Base
                    answer1 = currentVerb.simple;
                    answer2 = currentVerb.participle;
                    break;
                case 1: // Prompted with Simple
                    answer1 = currentVerb.base;
                    answer2 = currentVerb.participle;
                    break;
                case 2: // Prompted with Participle
                    answer1 = currentVerb.base;
                    answer2 = currentVerb.simple;
                    break;
            }

            correct1 = isAnswerCorrect(userAnswer1, answer1);
            correct2 = isAnswerCorrect(userAnswer2, answer2);

            // Apply visual feedback to inputs
            input1.classList.toggle('correct', correct1);
            input1.classList.toggle('incorrect', !correct1);
            
            input2.classList.toggle('correct', correct2);
            input2.classList.toggle('incorrect', !correct2);

            // Disable inputs
            input1.disabled = true;
            input2.disabled = true;

            // Show feedback message
            feedback.classList.remove('hidden');
            if (correct1 && correct2) {
                feedback.textContent = 'Correct! Well done.';
                feedback.className = 'mt-5 p-3 rounded-lg text-center font-medium bg-green-100 text-green-800';
            } else {
                let feedbackText = 'Not quite. The correct answers are: ';
                if (!correct1) feedbackText += ` ${answer1} `;
                if (!correct2) feedbackText += ` ${answer2} `;
                
                // Show the full correct answer
                feedback.innerHTML = `
                    Not quite. The correct forms are: <br>
                    <strong>${currentVerb.base} / ${currentVerb.simple} / ${currentVerb.participle}</strong>
                `;
                feedback.className = 'mt-5 p-3 rounded-lg text-center font-medium bg-red-100 text-red-800';
            }

            // Toggle buttons
            checkBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', async () => {
            // First, load and parse the data from the CSV
            await loadAndParseCSV(); 
            
            // Only initialize the app if verbs were successfully loaded
            if (verbList.length > 0) {
                loadQuestion();

                checkBtn.addEventListener('click', checkAnswer);
                nextBtn.addEventListener('click', loadQuestion);

                // Allow pressing Enter to check answer
                input1.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        checkBtn.click();
                    }
                });
                input2.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        checkBtn.click();
                    }
                });
            }
        });
    </script>
</body>
</html>